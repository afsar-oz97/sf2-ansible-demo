- name: Configure server seneyed-vpu-0101
  hosts:  seneyed-vpu-0101
  tasks:
   - name: Take snapshot first
     command: sudo timeshift --create --comments "A new backup"
   - name: Install softwares on seneyed-vpu-0101
     block:
       - name: Install nmap
         apt:
           name: nmap
           update_cache: yes
       - name: Install wget
        apt:
          name: wget
          update_cache: yes         
           
     rescue:
       - name: Save a flag file
         command: echo "Failed to update" | sudo tee /home/sensen/flag.txt
       - name : Restore and rebooting
         command: echo -e '\n' | \
                sudo timeshift --restore --scripted --snapshot \
                `sudo timeshift --list | sed -n 's/.*>  \([0-9]*-[0-9]*-[0-9]*_[0-9]*-[0-9]*-[0-9]*\).*/\1/p' | \
                tail -n 1` --skip-grub --yes
     ignore_unreachable: true
     
  
  
- name: Configure server sengame-vpu-0101
  hosts:  sengame-vpu-0101
  tasks:
   - name: Take snapshot first
     command: sudo timeshift --create --comments "A new backup"
   - name: Install softwares on seneyed-vpu-0101
     block:
       - name: Install nmap
         apt:
           name: nmap
           update_cache: yes
       - name: Install wget
        apt:
          name: wget
          update_cache: yes         
           
     rescue: 
       - name: Restore and reboot
         command: echo -e '\n' | \
                sudo timeshift --restore --scripted --snapshot \
                `sudo timeshift --list | sed -n 's/.*>  \([0-9]*-[0-9]*-[0-9]*_[0-9]*-[0-9]*-[0-9]*\).*/\1/p' | \
                tail -n 1` --skip-grub --yes
     ignore_unreachable: true
     
  
